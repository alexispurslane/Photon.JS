<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: main.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Returns new Photon.JS library instance, setting it up with the given options.
 * @param {object} obj The options for the new library, including a version, access token, debug mode, name of device, and id of device (all of which you can supply later).
 * @returns {object} A new library instance.
 */
function Photon(obj) {
    'use strict';

    if (obj.debug) console.debug(obj);

    /**
       The Photon.JS library, a close wrapper on the Spark Photon board's REST API.
       @version 0.3
       @namespace PhotonJS */
    var self = {
        /** This section contains some useful utility functions, as well as giving access to the control settings for the whole library.
            @namespace Settings
            @memberof PhotonJS */
        settings: {
            debug: obj.debug || false,
            save: function (k, v) {
                var s = v || this[k];
                this[k] = v;

                return s;
            },

            token: obj.token || '',
            authorized: obj.authorized || false,
            version: obj.version || 1,
            name: obj.name || '',
            id: obj.id || 0,

            url: function () {
                if (this.token === '') throw new Error("Undefined token.");
                var args = Array.prototype.slice.call(arguments);
                args.forEach(function (e) {
                    if (e === '' || e === 0 || e === undefined || e === null) {
                        throw new Error("Undefined or invalid section in path.");
                    }
                });
                var url = this.baseUrl + '/' + (args.join('/')) + '?access_token=' + this.token;

                if (this.debug) console.debug(url);

                return url;
            }
        },

        /** The Authorization section largely deals with access tokens, since access tokens are largely the only way to authorize yourself with a Photon board.
            @namespace Authorization 
            @memberof PhotonJS*/
        authorization: {
            authorize: function (tok) {
                this.settings.token = tok;
                if (this.settings.debug) console.debug(tok);
                return this;
            },

            list: function () {
                return $.get(this.settings.url('access_tokens'));
            },

            delete: function (tok) {
                return $.ajax({
                    url: this.settings.url('access_tokens', tok),
                    type: 'delete'
                });
            }
        },

        /** This section deals with some of the most important aspects of the Photon, being able to access variables and funtions over the network. This section also deals with the management of multiple devices.
            @namespace Devices 
            @memberof PhotonJS*/
        devices: {
            list: function () {
                return $.get(this.settings.url('devices'));
            },

            getInfo: function (id) {
                this.settings.save('id', id);
                if (this.settings.debug) console.debug(id);
                
                return $.get(this.settings.url('devices', id));
            },

            makeClaimCode: function (id) {
                this.settings.save('id', id);
                if (this.settings.debug) console.debug(id);
                
                return $.post(this.settings.url('device_claims'), {});
            },

            get: function (id, v) {
                this.settings.save('id', id);
                if (this.settings.debug) console.debug(id);
                
                return $.get(this.settings.url('devices', id, v));
            },

            claim: function (id) {
                this.settings.save('id', id);
                if (this.settings.debug) console.debug(id);
                
                return $.post(this.settings.url('devices'), {});
            },

            call: function (id, name, arg) {
                this.settings.save('id', id);
                this.settings.save('name', name);
                if (this.settings.debug) console.debug(id);
                if (this.settings.debug) console.debug(name);
                
                return $.post(this.settings.url('devices', id, name), { arg: arg });
            }
        },

        /** The Events namespace does exactly what it sounds like. It deals with creating, deleting, finding and accessing event streams.
            @namespace Events 
            @memberof PhotonJS*/
        events: {
            getStream: function (prefix) {
                if (prefix) {
                    if (this.settings.debug) console.debug(prefix);
                    return $.get(this.settings.url('events', prefix));
                } else {
                    return $.get(this.settings.url('events'));
                }
            },

            getDevicesStream: function (prefix) {
                if (prefix) {
                    if (this.settings.debug) console.debug(prefix);
                    return $.get(this.settings.url('devices', 'events', prefix));
                } else {
                    return $.get(this.settings.url('devices', 'events'));
                }
            },

            getDeviceStream: function (id, prefix) {
                this.settings.save('id', id);
                
                if (prefix) {
                    return $.get(this.settings.url('devices', id, 'events', prefix));
                } else {
                    return $.get(this.settings.url('devices', id, 'events'));
                }
            },

            publish: function (name, data, p, ttl) {
                this.settings.save('name', name);
                if (this.settings.debug) console.debug(name);
                
                data = data || {};
                p = p || false;

                if (!data) throw new Error("You must provide data to send.");

                if (ttl) {
                    if (this.settings.debug) console.debug({ data: data,
                                                             p: p,
                                                             ttl: ttl });
                    return $.post(this.setttings.url('devices', 'events'),
                                  { data: data,
                                    p: p,
                                    ttl: ttl });
                } else {
                    if (this.settings.debug) console.debug({ data: data,
                                                             p: p });

                    return $.post(this.setttings.url('devices', 'events'),
                                  { data: data,
                                    p: p });
                }
            }
        },

        /** The Firmware section is one of the less important namespaces, since you will normally flash your device using the online IDE, not through JavaScript. This section deals with flashing and updating code, as well as renaming devices.
            @namespace Firmware 
            @memberof PhotonJS*/
        firmware: {
            update: function (id) {
                this.settings.save('id', id);
                if (this.settings.debug) console.debug(id);
                
                return $.ajax({
                    url: this.settings.url('devices', id),
                    type: 'put'
                });
            },

            rename: function (id, name) {
                this.settings.save('id', id);
                this.settings.save('name', name);
                
                if (this.settings.debug) console.debug(id);
                if (this.settings.debug) console.debug(name);
                
                return $.ajax({
                    url: this.settings.url('devices', id),
                    data: { name: name },
                    type: 'put'
                });
            },

            flashSourceCode: function (id, file) {
                var boundary = "---------------------------7da24f2e50046";
                var body = '--' + boundary + '\r\n'
                    + 'Content-Disposition: form-data; name="file";'
                    + 'filename="code.cpp"\r\n'
                    + 'Content-type: plain/text\r\n\r\n'
                    + data + '\r\n'
                    + '--'+ boundary + '--';
                if (this.settings.debug) console.debug(body);
                if (this.settings.debug) console.debug(id);

                if (!id) throw new Error("An id is necessary for flashing source code. The Flash was not successful.");
                if (!file) throw new Error("You need code to flash code to a device. The Flash was not successful.");
                
                return $.ajax({
                    url: this.settings.url('devices', id),
                    contentType: "multipart/form-data; boundary=" + boundary,
                    data: { file: body },
                    type: 'put'
                });
            }
        },

        /** This section deals with team members and orginizations.
            @namespace Orginizations 
            @memberof PhotonJS*/
        orginizations: {
            list: function () {
                return $.get(this.settings.url('orgs')); // orcs?
            },

            get: function (slug) {
                if (this.settings.debug) console.debug(slug);
                return $.get(this.settings.url('orgs', slug)); // Orcs like slugs!
            },

            removeTeamMember: function (slug, username) {
                this.settings.save('slug', slug);
                if (this.settings.debug) console.debug(slug);
                if (this.settings.debug) console.debug(username);
                
                return $.ajax({
                    type: 'delete',
                    url: this.settings.url('orgs', slug, 'users', username)
                });
            },    
        },

        /** This section deals with products.
            @namespace Products 
            @memberof PhotonJS*/
        products: {
            get: function (slug, pSlug) {
                if (this.settings.debug) console.debug(slug);
                if (this.settings.debug) console.debug(pSlug);
                
                return $.get(this.settings.url('orgs', slug, 'products', pSlug));
            },

            genClaimCode: function (slug, pSlug) {
                if (this.settings.debug) console.debug(slug);
                if (this.settings.debug) console.debug(pSlug);
                
                return $.post(this.settings.url('orgs', slug, 'products', pSlug, 'device_claims'));
            },

            removeDevice: function (slug, pSlug, id) {
                if (this.settings.debug) console.debug(slug);
                if (this.settings.debug) console.debug(pSlug);
                if (this.settings.debug) console.debug(id);
                
                return $.ajax({
                    type: 'delete',
                    url: this.settings.url('orgs', slug, 'products', pSlug, 'devices', id)
                });
            }
        }
    };
    
    self.auth.settings = Photon.settings;
    self.devices.settings = Photon.settings;
    self.firmware.settings = Photon.settings;
    self.products.settings = Photon.settings;
    self.orgs.settings = Photon.settings;
    self.settings.baseUrl = 'https://api.particle.io/v' + self.settings.version;
    if (obj.debug) console.debug(self.settings.baseUrl);

    return self;
}

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="PhotonJS.html">PhotonJS</a></li><li><a href="PhotonJS.Authorization.html">Authorization</a></li><li><a href="PhotonJS.Devices.html">Devices</a></li><li><a href="PhotonJS.Events.html">Events</a></li><li><a href="PhotonJS.Firmware.html">Firmware</a></li><li><a href="PhotonJS.Orginizations.html">Orginizations</a></li><li><a href="PhotonJS.Products.html">Products</a></li><li><a href="PhotonJS.Settings.html">Settings</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Photon">Photon</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Tue Nov 24 2015 06:54:57 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
